import{u as J,f as G,x as z,g as K,h as Q,c as M,o as j,a as d,d as i,q as W,t as f,w as s,D as t,F as X,k as p,l as Y,e as b}from"./index-Na7mEAWg.js";import{B,a as Z,b as _,c as r}from"./BaseModal-BXVtofVG.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={class:"surface-panel",style:{display:"flex","flex-direction":"column",gap:"1.5rem"}},oe={style:{display:"flex","flex-wrap":"wrap",gap:"1.25rem","justify-content":"space-between","align-items":"flex-start"}},ne={key:0,class:"stat-chip"},le=["onClick"],ie=["onClick"],te={__name:"GanadoView",setup(re){const{token:g}=J(),{pushToast:m}=Y(),I=G([]),y=G([]),N=G([]),x=G(!0),c=G(!1),h=[{value:"M",label:"Macho"},{value:"H",label:"Hembra"}],D=[{key:"id",label:"ID",sortable:!0},{key:"nombre",label:"Nombre",sortable:!0},{key:"sexo",label:"Sexo",sortable:!0},{key:"raza",label:"Raza",sortable:!0},{key:"finca",label:"Finca"},{key:"tipo",label:"Tipo"},{key:"fechaNacimiento",label:"Nacimiento",sortable:!0}],n=z({idfinca:"",idtipoGanado:"",fechaNacimiento:"",sexo:"",marcaGanado:"",raza:"",caracteristicas:"",nombreGanado:"",numeroId:null,numeroInventario:null,urlImagen:""}),u=z({idfinca:"",idtipoGanado:"",fechaNacimiento:"",sexo:""}),l=z({open:!1,id:null,form:{idfinca:"",idtipoGanado:"",fechaNacimiento:"",sexo:"",marcaGanado:"",raza:"",caracteristicas:"",nombreGanado:"",numeroId:null,numeroInventario:null,urlImagen:""}}),T=K(()=>n.idfinca&&n.idtipoGanado&&n.fechaNacimiento&&n.sexo);function U(o){return{id:o.idganado??o.id??null,idfinca:o.idfinca??o.Idfinca??null,idtipoGanado:o.idtipoGanado??o.IdtipoGanado??o.idtipo??null,fechaNacimiento:o.fechaNacimiento??"",sexo:o.sexo??"",marcaGanado:o.marcaGanado??o.marca??"",raza:o.raza??"",caracteristicas:o.caracteristicas??"",nombre:o.nombreGanado??o.nombre??"",nombreGanado:o.nombreGanado??o.nombre??"",numeroId:o.numeroId??null,numeroInventario:o.numeroInventario??null,urlImagen:o.urlImagen??""}}function E(o){const e=o.idfinca??o.id??null,a=o.nombreFinca??o.nombre??"";return{value:e,label:`${e} - ${a}`.trim()}}function q(o){const e=o.id??o.idtipo??o.idTipo??null,a=o.nombre??o.descripcion??"";return{value:e,label:`${e} - ${a}`.trim()}}function R(o){const e=y.value.find(a=>String(a.value)===String(o));return e?e.label:o}function L(o){const e=N.value.find(a=>String(a.value)===String(o));return e?e.label:o}function $(o){if(!o)return"-";try{return new Date(o).toLocaleDateString("es-ES")}catch{return o}}function A(){return u.idfinca=n.idfinca?"":"Selecciona la finca",u.idtipoGanado=n.idtipoGanado?"":"Selecciona el tipo",u.fechaNacimiento=n.fechaNacimiento?"":"Define la fecha",u.sexo=n.sexo?"":"Selecciona el sexo",!u.idfinca&&!u.idtipoGanado&&!u.fechaNacimiento&&!u.sexo}async function v(){x.value=!0;try{const o=g.value,[e,a,k]=await Promise.all([p.list(o),p.fincas(o),p.tipos(o)]);I.value=e.map(U).filter(V=>V.id),y.value=a.map(E).filter(V=>V.value),N.value=k.map(q).filter(V=>V.value)}catch(o){m(o.message||"No se pudo cargar el ganado","error")}finally{x.value=!1}}function C(o){return{idfinca:Number(o.idfinca),idtipoGanado:Number(o.idtipoGanado),fechaNacimiento:o.fechaNacimiento,sexo:o.sexo,marcaGanado:o.marcaGanado||null,raza:o.raza||null,caracteristicas:o.caracteristicas||null,nombreGanado:o.nombreGanado||null,numeroId:o.numeroId!==null&&o.numeroId!==""?Number(o.numeroId):null,numeroInventario:o.numeroInventario!==null&&o.numeroInventario!==""?Number(o.numeroInventario):null,urlImagen:o.urlImagen||null}}async function H(){if(A()){c.value=!0;try{const o=C(n),e=await p.create(o,g.value);m(`Ganado ${(e==null?void 0:e.idganado)??(e==null?void 0:e.id)??""} creado`,"success"),S(),await v()}catch(o){m(o.message||"No se pudo crear el registro","error")}finally{c.value=!1}}}function S(){Object.assign(n,{idfinca:"",idtipoGanado:"",fechaNacimiento:"",sexo:"",marcaGanado:"",raza:"",caracteristicas:"",nombreGanado:"",numeroId:null,numeroInventario:null,urlImagen:""}),Object.assign(u,{idfinca:"",idtipoGanado:"",fechaNacimiento:"",sexo:""})}async function O(o){try{const e=await p.details(o.id,g.value),a=U(e);l.open=!0,l.id=a.id,Object.assign(l.form,{idfinca:a.idfinca,idtipoGanado:a.idtipoGanado,fechaNacimiento:a.fechaNacimiento,sexo:a.sexo,marcaGanado:a.marcaGanado,raza:a.raza,caracteristicas:a.caracteristicas,nombreGanado:a.nombreGanado,numeroId:a.numeroId,numeroInventario:a.numeroInventario,urlImagen:a.urlImagen})}catch(e){m(e.message||"No se pudo cargar el registro","error")}}function F(){l.open=!1,l.id=null}async function w(){c.value=!0;try{const o=C(l.form);await p.update(l.id,o,g.value),m("Ganado actualizado","success"),F(),await v()}catch(o){m(o.message||"No se pudo actualizar","error")}finally{c.value=!1}}async function P(o){if(confirm(`¿Eliminar el registro ${o.id}? Esta acción no se puede deshacer.`))try{await p.remove(o.id,g.value),m("Registro eliminado","success"),await v()}catch(e){m(e.message||"No se pudo eliminar","error")}}return Q(()=>{v()}),(o,e)=>(j(),M(X,null,[d("section",ae,[d("header",oe,[e[23]||(e[23]=d("div",null,[d("div",{class:"stat-chip"},"Inventario vivo"),d("h1",{class:"hero-title",style:{"font-size":"2.2rem"}},"Control de ganado"),d("p",{class:"hero-subtitle"},"Sincroniza nacimientos, tipos y ubicaciones sin abandonar tu flujo de trabajo.")],-1)),I.value.length?(j(),M("span",ne,f(I.value.length)+" registros",1)):W("",!0)]),i(t(B),{title:"Registrar nuevo ganado",layout:"three",loading:c.value,"is-valid":T.value,onSubmit:H},{default:s(()=>[i(t(r),{modelValue:n.idfinca,"onUpdate:modelValue":e[0]||(e[0]=a=>n.idfinca=a),label:"Finca",type:"select",options:y.value,error:u.idfinca,required:""},null,8,["modelValue","options","error"]),i(t(r),{modelValue:n.idtipoGanado,"onUpdate:modelValue":e[1]||(e[1]=a=>n.idtipoGanado=a),label:"Tipo",type:"select",options:N.value,error:u.idtipoGanado,required:""},null,8,["modelValue","options","error"]),i(t(r),{modelValue:n.fechaNacimiento,"onUpdate:modelValue":e[2]||(e[2]=a=>n.fechaNacimiento=a),label:"Fecha nacimiento",type:"date",error:u.fechaNacimiento,required:""},null,8,["modelValue","error"]),i(t(r),{modelValue:n.sexo,"onUpdate:modelValue":e[3]||(e[3]=a=>n.sexo=a),label:"Sexo",type:"select",options:h,error:u.sexo,required:""},null,8,["modelValue","error"]),i(t(r),{modelValue:n.nombreGanado,"onUpdate:modelValue":e[4]||(e[4]=a=>n.nombreGanado=a),label:"Nombre",help:"Nombre opcional del animal"},null,8,["modelValue"]),i(t(r),{modelValue:n.raza,"onUpdate:modelValue":e[5]||(e[5]=a=>n.raza=a),label:"Raza",help:"Raza del ganado"},null,8,["modelValue"]),i(t(r),{modelValue:n.marcaGanado,"onUpdate:modelValue":e[6]||(e[6]=a=>n.marcaGanado=a),label:"Marca",help:"Marca identificativa"},null,8,["modelValue"]),i(t(r),{modelValue:n.caracteristicas,"onUpdate:modelValue":e[7]||(e[7]=a=>n.caracteristicas=a),label:"Características",help:"Características distintivas"},null,8,["modelValue"]),i(t(r),{modelValue:n.numeroId,"onUpdate:modelValue":e[8]||(e[8]=a=>n.numeroId=a),label:"Número ID",type:"number",min:"0"},null,8,["modelValue"]),i(t(r),{modelValue:n.numeroInventario,"onUpdate:modelValue":e[9]||(e[9]=a=>n.numeroInventario=a),label:"Inventario",type:"number",min:"0"},null,8,["modelValue"]),i(t(r),{modelValue:n.urlImagen,"onUpdate:modelValue":e[10]||(e[10]=a=>n.urlImagen=a),label:"URL imagen",type:"url",placeholder:"https://ejemplo.com/imagen.jpg",help:"URL de imagen del animal"},null,8,["modelValue"])]),_:1},8,["loading","is-valid"])]),i(t(Z),{data:I.value,columns:D,loading:x.value,title:"Ganado registrado","empty-title":"Sin ganado registrado","empty-message":"No hay animales registrados en el sistema. Agrega el primer registro usando el formulario anterior.","page-size":15},{actions:s(()=>[d("button",{class:"btn btn-outline",onClick:v},[...e[24]||(e[24]=[d("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),b(" Actualizar ",-1)])])]),"cell-nombre":s(({value:a})=>[b(f(a||"-"),1)]),"cell-raza":s(({value:a})=>[b(f(a||"-"),1)]),"cell-finca":s(({item:a})=>[b(f(R(a.idfinca)),1)]),"cell-tipo":s(({item:a})=>[b(f(L(a.idtipoGanado)),1)]),"cell-fechaNacimiento":s(({value:a})=>[b(f($(a)),1)]),"row-actions":s(({item:a})=>[d("button",{class:"btn btn-outline btn-sm",onClick:k=>O(a),title:"Editar registro"},[...e[25]||(e[25]=[d("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,le),d("button",{class:"btn btn-ghost btn-sm",onClick:k=>P(a),title:"Eliminar registro"},[...e[26]||(e[26]=[d("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,ie)]),"empty-actions":s(()=>[d("button",{class:"btn btn-primary",onClick:S}," Crear primer registro ")]),_:1},8,["data","loading"]),i(t(_),{modelValue:l.open,"onUpdate:modelValue":e[22]||(e[22]=a=>l.open=a),title:"Editar ganado",subtitle:"Modifica los datos del registro seleccionado",size:"lg","show-footer":"",loading:c.value,onConfirm:w,onCancel:F,"confirm-text":"Actualizar"},{default:s(()=>[i(t(B),{layout:"three","show-actions":!1,loading:c.value},{default:s(()=>[i(t(r),{modelValue:l.form.idfinca,"onUpdate:modelValue":e[11]||(e[11]=a=>l.form.idfinca=a),label:"Finca",type:"select",options:y.value,required:""},null,8,["modelValue","options"]),i(t(r),{modelValue:l.form.idtipoGanado,"onUpdate:modelValue":e[12]||(e[12]=a=>l.form.idtipoGanado=a),label:"Tipo",type:"select",options:N.value,required:""},null,8,["modelValue","options"]),i(t(r),{modelValue:l.form.fechaNacimiento,"onUpdate:modelValue":e[13]||(e[13]=a=>l.form.fechaNacimiento=a),label:"Fecha nacimiento",type:"date",required:""},null,8,["modelValue"]),i(t(r),{modelValue:l.form.sexo,"onUpdate:modelValue":e[14]||(e[14]=a=>l.form.sexo=a),label:"Sexo",type:"select",options:h,required:""},null,8,["modelValue"]),i(t(r),{modelValue:l.form.nombreGanado,"onUpdate:modelValue":e[15]||(e[15]=a=>l.form.nombreGanado=a),label:"Nombre"},null,8,["modelValue"]),i(t(r),{modelValue:l.form.raza,"onUpdate:modelValue":e[16]||(e[16]=a=>l.form.raza=a),label:"Raza"},null,8,["modelValue"]),i(t(r),{modelValue:l.form.marcaGanado,"onUpdate:modelValue":e[17]||(e[17]=a=>l.form.marcaGanado=a),label:"Marca"},null,8,["modelValue"]),i(t(r),{modelValue:l.form.caracteristicas,"onUpdate:modelValue":e[18]||(e[18]=a=>l.form.caracteristicas=a),label:"Características"},null,8,["modelValue"]),i(t(r),{modelValue:l.form.numeroId,"onUpdate:modelValue":e[19]||(e[19]=a=>l.form.numeroId=a),label:"Número ID",type:"number",min:"0"},null,8,["modelValue"]),i(t(r),{modelValue:l.form.numeroInventario,"onUpdate:modelValue":e[20]||(e[20]=a=>l.form.numeroInventario=a),label:"Inventario",type:"number",min:"0"},null,8,["modelValue"]),i(t(r),{modelValue:l.form.urlImagen,"onUpdate:modelValue":e[21]||(e[21]=a=>l.form.urlImagen=a),label:"URL imagen",type:"url"},null,8,["modelValue"])]),_:1},8,["loading"])]),_:1},8,["modelValue","loading"])],64))}},me=ee(te,[["__scopeId","data-v-9ee0a3ce"]]);export{me as default};
