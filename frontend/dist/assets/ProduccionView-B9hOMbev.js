import{u as se,f as k,g as C,x as F,h as de,c as ce,o as ue,a as t,d as i,t as f,w as d,D as l,k as me,l as fe,n as j,e as w}from"./index-Na7mEAWg.js";import{B as I,a as H,b as $,c as p}from"./BaseModal-BXVtofVG.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const he={class:"produccion-container"},ve={class:"surface-panel"},ge={class:"header-section"},be={class:"header-stats"},ye={class:"stat-item"},ke={class:"stat-value"},we={class:"stat-item"},Ce={class:"stat-value"},Ve={class:"surface-panel"},Me={class:"animal-info"},xe={class:"animal-name"},De={class:"animal-id"},Fe={class:"quantity-badge"},Pe=["onClick"],Se=["onClick"],Ie={class:"surface-panel"},Te={class:"periodo-info"},ze={class:"fecha-inicio"},Ee={class:"fecha-fin"},Oe={class:"total-badge"},Be=["onClick"],Ue=["onClick","disabled"],Ae={__name:"ProduccionView",setup(Ne){const{token:q}=se(),{pushToast:u}=fe(),P=k(!0),T=k(!0),g=k(!1),v=k([]),V=k([]),M=k([]),y=C(()=>new Date().toISOString().split("T")[0]),z=C(()=>M.value.map(a=>({value:a.id,label:`${a.nombre||`Animal ${a.id}`} - ${a.raza||"Sin raza"}`}))),x=[{value:"Mañana",label:"Mañana (6:00 - 12:00)"},{value:"Tarde",label:"Tarde (12:00 - 18:00)"},{value:"Noche",label:"Noche (18:00 - 24:00)"},{value:"Madrugada",label:"Madrugada (0:00 - 6:00)"}],L=C(()=>{const a=new Date().toISOString().split("T")[0];return v.value.filter(e=>e.fecha===a).reduce((e,o)=>e+(parseFloat(o.cantidad)||0),0).toFixed(1)}),R=C(()=>{const a=new Date;a.setDate(1);const e=a.toISOString().split("T")[0];return v.value.filter(o=>o.fecha>=e).reduce((o,s)=>o+(parseFloat(s.cantidad)||0),0).toFixed(1)}),_=C(()=>n.idganado&&n.fecha&&n.horario&&n.cantidad&&n.cantidad>0),n=F({idganado:"",fecha:y.value,horario:"",cantidad:"",observaciones:""}),m=F({idganado:"",fecha:"",horario:"",cantidad:""}),c=F({open:!1,id:null,form:{fecha:"",horario:"",cantidad:"",observaciones:""}}),r=F({open:!1,form:{idganado:"",fechaInicio:y.value,fechaFin:"",observaciones:""}}),G=[{key:"animal",label:"Animal"},{key:"fecha",label:"Fecha",sortable:!0},{key:"horario",label:"Horario"},{key:"cantidad",label:"Cantidad",sortable:!0},{key:"observaciones",label:"Observaciones"}],Q=[{key:"animal",label:"Animal"},{key:"periodo",label:"Período"},{key:"duracion",label:"Duración"},{key:"total",label:"Total Producido",sortable:!0},{key:"estado",label:"Estado"}];async function E(){P.value=!0;try{const a=q.value,e=await me.list(a);M.value=e.map(o=>({id:o.idganado||o.id,nombre:o.nombreGanado||o.nombre,raza:o.raza})),await J()}catch(a){u(a.message||"Error al cargar datos de producción","error")}finally{P.value=!1}}async function J(){const a=[],e=M.value.slice(0,5);for(let s=0;s<20;s++){const h=e[Math.floor(Math.random()*e.length)],b=new Date;b.setDate(b.getDate()-Math.floor(Math.random()*30)),a.push({id:s+1,idganado:(h==null?void 0:h.id)||1,fecha:b.toISOString().split("T")[0],horario:x[Math.floor(Math.random()*x.length)].value,cantidad:(Math.random()*20+5).toFixed(1),observaciones:Math.random()>.7?"Producción normal":""})}v.value=a.sort((s,h)=>new Date(h.fecha)-new Date(s.fecha));const o=[];for(let s=0;s<5;s++){const h=e[Math.floor(Math.random()*e.length)],b=new Date;b.setMonth(b.getMonth()-Math.floor(Math.random()*6));const S=new Date(b);S.setMonth(S.getMonth()+3+Math.floor(Math.random()*3)),o.push({id:s+1,idganado:(h==null?void 0:h.id)||1,fechaInicio:b.toISOString().split("T")[0],fechaFin:S.toISOString().split("T")[0],cantidadTotal:(Math.random()*500+200).toFixed(1),observaciones:`Ciclo ${s+1}`})}V.value=o,T.value=!1}function K(){return m.idganado=n.idganado?"":"Selecciona un animal",m.fecha=n.fecha?"":"Ingresa la fecha",m.horario=n.horario?"":"Selecciona el horario",m.cantidad=n.cantidad&&n.cantidad>0?"":"Ingresa una cantidad válida",!m.idganado&&!m.fecha&&!m.horario&&!m.cantidad}async function W(){if(K()){g.value=!0;try{const a={id:v.value.length+1,idganado:parseInt(n.idganado),fecha:n.fecha,horario:n.horario,cantidad:parseFloat(n.cantidad).toFixed(1),observaciones:n.observaciones||""};v.value.unshift(a),u("Producción registrada exitosamente","success"),O()}catch(a){u(a.message||"Error al registrar producción","error")}finally{g.value=!1}}}function O(){Object.assign(n,{idganado:"",fecha:y.value,horario:"",cantidad:"",observaciones:""}),Object.assign(m,{idganado:"",fecha:"",horario:"",cantidad:""})}function X(a){c.open=!0,c.id=a.id,Object.assign(c.form,{fecha:a.fecha,horario:a.horario,cantidad:a.cantidad,observaciones:a.observaciones||""})}function B(){c.open=!1,c.id=null}async function Y(){g.value=!0;try{const a=v.value.findIndex(e=>e.id===c.id);a!==-1&&Object.assign(v.value[a],c.form),u("Producción actualizada exitosamente","success"),B()}catch(a){u(a.message||"Error al actualizar producción","error")}finally{g.value=!1}}async function Z(a){if(confirm(`¿Eliminar el registro de producción del ${D(a.fecha)}?`))try{const e=v.value.findIndex(o=>o.id===a.id);e!==-1&&v.value.splice(e,1),u("Registro eliminado exitosamente","success")}catch(e){u(e.message||"Error al eliminar registro","error")}}function U(){r.open=!0}function A(){r.open=!1,Object.assign(r.form,{idganado:"",fechaInicio:y.value,fechaFin:"",observaciones:""})}async function ee(){g.value=!0;try{const a={id:V.value.length+1,idganado:parseInt(r.form.idganado),fechaInicio:r.form.fechaInicio,fechaFin:r.form.fechaFin,cantidadTotal:"0.0",observaciones:r.form.observaciones||""};V.value.unshift(a),u("Ciclo de producción creado exitosamente","success"),A()}catch(a){u(a.message||"Error al crear ciclo","error")}finally{g.value=!1}}function oe(a){u(`Ver detalles del ciclo ${a.id} - Funcionalidad en desarrollo`,"info")}function ae(a){confirm("¿Cerrar el ciclo de producción? Esta acción no se puede deshacer.")&&u(`Ciclo ${a.id} cerrado exitosamente`,"success")}function te(){u("Exportando datos de producción...","info"),setTimeout(()=>{u("Archivo exportado exitosamente","success")},1500)}function N(a){const e=M.value.find(o=>o.id===a);return e?e.nombre||`Animal ${a}`:`Animal ${a}`}function D(a){if(!a)return"-";try{return new Date(a).toLocaleDateString("es-ES")}catch{return a}}function ne(a){return{Mañana:"horario-morning",Tarde:"horario-afternoon",Noche:"horario-evening",Madrugada:"horario-night"}[a]||""}function ie(a,e){if(!a||!e)return"-";const o=new Date(a),s=new Date(e),h=Math.abs(s-o);return Math.ceil(h/(1e3*60*60*24))}function le(a){const e=new Date;return new Date(a.fechaFin)>e?"status-active":"status-completed"}function re(a){const e=new Date;return new Date(a.fechaFin)>e?"Activo":"Completado"}return de(()=>{E()}),(a,e)=>(ue(),ce("div",he,[t("section",ve,[t("div",ge,[e[17]||(e[17]=t("div",{class:"header-content"},[t("div",{class:"stat-chip"},"Gestión productiva"),t("h1",{class:"hero-title"},"Control de Producción"),t("p",{class:"hero-subtitle"}," Registra y monitorea la producción diaria de leche, carne y otros productos. Gestiona ciclos productivos completos. ")],-1)),t("div",be,[t("div",ye,[t("span",ke,f(L.value)+"L",1),e[15]||(e[15]=t("span",{class:"stat-label"},"Hoy",-1))]),t("div",we,[t("span",Ce,f(R.value)+"L",1),e[16]||(e[16]=t("span",{class:"stat-label"},"Este mes",-1))])])])]),t("section",Ve,[i(l(I),{title:"Registro Rápido de Producción",subtitle:"Registra la producción diaria de un animal",layout:"three",loading:g.value,"is-valid":_.value,"submit-text":"Registrar Producción",onSubmit:W},{default:d(()=>[i(l(p),{modelValue:n.idganado,"onUpdate:modelValue":e[0]||(e[0]=o=>n.idganado=o),label:"Animal",type:"select",options:z.value,error:m.idganado,required:"",help:"Selecciona el animal productor"},null,8,["modelValue","options","error"]),i(l(p),{modelValue:n.fecha,"onUpdate:modelValue":e[1]||(e[1]=o=>n.fecha=o),label:"Fecha",type:"date",max:y.value,error:m.fecha,required:""},null,8,["modelValue","max","error"]),i(l(p),{modelValue:n.horario,"onUpdate:modelValue":e[2]||(e[2]=o=>n.horario=o),label:"Horario",type:"select",options:x,error:m.horario,required:""},null,8,["modelValue","error"]),i(l(p),{modelValue:n.cantidad,"onUpdate:modelValue":e[3]||(e[3]=o=>n.cantidad=o),label:"Cantidad (Litros)",type:"number",min:"0",step:"0.1",error:m.cantidad,required:"",help:"Cantidad producida en litros"},null,8,["modelValue","error"]),i(l(p),{modelValue:n.observaciones,"onUpdate:modelValue":e[4]||(e[4]=o=>n.observaciones=o),label:"Observaciones",type:"textarea",rows:2,help:"Notas adicionales sobre la producción"},null,8,["modelValue"])]),_:1},8,["loading","is-valid"])]),i(l(H),{data:v.value,columns:G,loading:P.value,title:"Registros de Producción","empty-title":"Sin registros de producción","empty-message":"No hay registros de producción. Comienza registrando la producción diaria de tus animales.","page-size":15,"search-placeholder":"Buscar por animal, fecha o cantidad..."},{actions:d(()=>[t("button",{class:"btn btn-outline",onClick:te},[...e[18]||(e[18]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),w(" Exportar ",-1)])]),t("button",{class:"btn btn-primary",onClick:U},[...e[19]||(e[19]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),w(" Nuevo Ciclo ",-1)])]),t("button",{class:"btn btn-outline",onClick:E},[...e[20]||(e[20]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),w(" Actualizar ",-1)])])]),"cell-animal":d(({item:o})=>[t("div",Me,[t("span",xe,f(N(o.idganado)),1),t("small",De,"ID: "+f(o.idganado),1)])]),"cell-fecha":d(({value:o})=>[w(f(D(o)),1)]),"cell-cantidad":d(({value:o})=>[t("span",Fe,f(o)+"L",1)]),"cell-horario":d(({value:o})=>[t("span",{class:j(["horario-badge",ne(o)])},f(o),3)]),"row-actions":d(({item:o})=>[t("button",{class:"btn btn-outline btn-sm",onClick:s=>X(o),title:"Editar registro"},[...e[21]||(e[21]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,Pe),t("button",{class:"btn btn-ghost btn-sm",onClick:s=>Z(o),title:"Eliminar registro"},[...e[22]||(e[22]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Se)]),"empty-actions":d(()=>[t("button",{class:"btn btn-primary",onClick:O}," Registrar Primera Producción ")]),_:1},8,["data","loading"]),t("section",Ie,[t("header",{class:"section-header"},[e[23]||(e[23]=t("div",null,[t("h2",{class:"section-title"},"Ciclos de Producción"),t("p",{class:"section-subtitle"},"Gestiona ciclos productivos completos por animal")],-1)),t("button",{class:"btn btn-outline",onClick:U}," Nuevo Ciclo ")]),i(l(H),{data:V.value,columns:Q,loading:T.value,title:"","show-header":!1,"empty-title":"Sin ciclos registrados","empty-message":"No hay ciclos de producción registrados. Crea el primer ciclo para gestionar períodos productivos completos.","page-size":10},{"cell-animal":d(({item:o})=>[w(f(N(o.idganado)),1)]),"cell-periodo":d(({item:o})=>[t("div",Te,[t("span",ze,f(D(o.fechaInicio)),1),e[24]||(e[24]=t("span",{class:"separator"},"→",-1)),t("span",Ee,f(D(o.fechaFin)),1)])]),"cell-duracion":d(({item:o})=>[w(f(ie(o.fechaInicio,o.fechaFin))+" días ",1)]),"cell-total":d(({value:o})=>[t("span",Oe,f(o)+"L",1)]),"cell-estado":d(({item:o})=>[t("span",{class:j(["status-badge",le(o)])},f(re(o)),3)]),"row-actions":d(({item:o})=>[t("button",{class:"btn btn-outline btn-sm",onClick:s=>oe(o),title:"Ver detalles"},[...e[25]||(e[25]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)])],8,Be),t("button",{class:"btn btn-ghost btn-sm",onClick:s=>ae(o),disabled:o.fechaFin&&new Date(o.fechaFin)<=new Date,title:"Cerrar ciclo"},[...e[26]||(e[26]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])],8,Ue)]),_:1},8,["data","loading"])]),i(l($),{modelValue:c.open,"onUpdate:modelValue":e[9]||(e[9]=o=>c.open=o),title:"Editar Producción",subtitle:"Modifica los datos del registro de producción",size:"md","show-footer":"",loading:g.value,onConfirm:Y,onCancel:B,"confirm-text":"Actualizar"},{default:d(()=>[i(l(I),{layout:"two","show-actions":!1},{default:d(()=>[i(l(p),{modelValue:c.form.fecha,"onUpdate:modelValue":e[5]||(e[5]=o=>c.form.fecha=o),label:"Fecha",type:"date",max:y.value,required:""},null,8,["modelValue","max"]),i(l(p),{modelValue:c.form.horario,"onUpdate:modelValue":e[6]||(e[6]=o=>c.form.horario=o),label:"Horario",type:"select",options:x,required:""},null,8,["modelValue"]),i(l(p),{modelValue:c.form.cantidad,"onUpdate:modelValue":e[7]||(e[7]=o=>c.form.cantidad=o),label:"Cantidad (Litros)",type:"number",min:"0",step:"0.1",required:""},null,8,["modelValue"]),i(l(p),{modelValue:c.form.observaciones,"onUpdate:modelValue":e[8]||(e[8]=o=>c.form.observaciones=o),label:"Observaciones",type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue","loading"]),i(l($),{modelValue:r.open,"onUpdate:modelValue":e[14]||(e[14]=o=>r.open=o),title:"Nuevo Ciclo de Producción",subtitle:"Crear un nuevo período productivo para un animal",size:"md","show-footer":"",loading:g.value,onConfirm:ee,onCancel:A,"confirm-text":"Crear Ciclo"},{default:d(()=>[i(l(I),{layout:"two","show-actions":!1},{default:d(()=>[i(l(p),{modelValue:r.form.idganado,"onUpdate:modelValue":e[10]||(e[10]=o=>r.form.idganado=o),label:"Animal",type:"select",options:z.value,required:""},null,8,["modelValue","options"]),i(l(p),{modelValue:r.form.fechaInicio,"onUpdate:modelValue":e[11]||(e[11]=o=>r.form.fechaInicio=o),label:"Fecha Inicio",type:"date",max:y.value,required:""},null,8,["modelValue","max"]),i(l(p),{modelValue:r.form.fechaFin,"onUpdate:modelValue":e[12]||(e[12]=o=>r.form.fechaFin=o),label:"Fecha Fin Estimada",type:"date",min:r.form.fechaInicio,help:"Fecha estimada de fin del ciclo (opcional)"},null,8,["modelValue","min"]),i(l(p),{modelValue:r.form.observaciones,"onUpdate:modelValue":e[13]||(e[13]=o=>r.form.observaciones=o),label:"Observaciones",type:"textarea",rows:3,help:"Notas sobre el ciclo productivo"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue","loading"])]))}},qe=pe(Ae,[["__scopeId","data-v-9dd3fd01"]]);export{qe as default};
