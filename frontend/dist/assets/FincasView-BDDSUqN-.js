import{u as D,f as U,x as F,h as H,c as u,o as s,a as o,m as M,z as L,j as d,q as b,y as m,t as i,v as q,F as N,i as x,T as $,C as y,l as j}from"./index-Na7mEAWg.js";const G={class:"surface-panel",style:{display:"flex","flex-direction":"column",gap:"1.5rem"}},R={key:0,class:"form-error"},J={key:0,class:"form-error"},K={key:0,class:"form-error"},O=["value"],Q={key:0,class:"form-error"},W={style:{"grid-column":"1 / -1",display:"flex",gap:"1rem"}},X=["disabled"],Y=["disabled"],Z={class:"table-panel"},_={style:{display:"flex","justify-content":"space-between","align-items":"center",padding:"1.5rem 1.5rem 0"}},w={key:0,class:"stat-chip"},oo={style:{"overflow-x":"auto"}},eo={class:"table"},to={key:0},lo={style:{"text-align":"right"}},ro=["onClick"],no=["onClick"],io={key:1},ao={key:0,class:"modal-backdrop",role:"dialog","aria-modal":"true"},so={class:"modal-surface"},uo=["value"],mo={class:"modal-actions"},po=["disabled"],fo={__name:"FincasView",setup(bo){const{token:g}=D(),{pushToast:c}=j(),f=U([]),C=U([]),h=U(!0),p=U(!1),n=F({nombre:"",ubicacion:"",hectareas:null,propietario:"",latitud:null,longitud:null}),a=F({nombre:"",ubicacion:"",hectareas:"",propietario:""}),r=F({open:!1,id:null,form:{nombre:"",ubicacion:"",hectareas:null,propietario:"",latitud:null,longitud:null}});function S(t){return{id:t.idfinca??t.id??t.Id??null,nombre:t.nombreFinca??t.nombre??t.Nombre??"",ubicacion:t.ubicacion??t.Ubicacion??"",hectareas:t.hectareas??t.Hectareas??0,propietario:t.propietario??t.idpropietario??t.Idpropietario??null,propietarioNombre:t.propietarioNombre??t.PropietarioNombre??t.propietarioNombreCompleto??"",latitud:t.latitud??t.Latitud??null,longitud:t.longitud??t.Longitud??null}}function E(t){return{id:t.id??t.idusuario??t.Idusuario??null,nombre:[t.nombre,t.nombreUr,t.NombreUr,t.apellido,t.apellidoUr,t.ApellidoUr].filter(Boolean).join(" ").trim()}}async function k(){h.value=!0;try{const t=g.value,[e,l]=await Promise.all([y.propietarios(t),y.list(t)]);C.value=e.map(E).filter(v=>v.id),f.value=l.map(S).filter(v=>v.id)}catch(t){c(t.message||"No se pudo cargar la informacion","error")}finally{h.value=!1}}function I(){return a.nombre=n.nombre?"":"Ingresa el nombre",a.ubicacion=n.ubicacion?"":"Ingresa la ubicacion",a.hectareas=n.hectareas&&n.hectareas>0?"":"Ingresa hectareas validas",a.propietario=n.propietario?"":"Selecciona propietario",!a.nombre&&!a.ubicacion&&!a.hectareas&&!a.propietario}async function P(){if(I()){p.value=!0;try{const t={nombreFinca:n.nombre,ubicacion:n.ubicacion,hectareas:Number(n.hectareas),propietario:Number(n.propietario),latitud:n.latitud??null,longitud:n.longitud??null},e=await y.create(t,g.value);c(`Finca ${(e==null?void 0:e.idfinca)??(e==null?void 0:e.id)??""} creada`,"success"),z(),await k()}catch(t){c(t.message||"Error al crear finca","error")}finally{p.value=!1}}}function z(){n.nombre="",n.ubicacion="",n.hectareas=null,n.propietario="",n.latitud=null,n.longitud=null}function T(t){r.open=!0,r.id=t.id,r.form.nombre=t.nombre,r.form.ubicacion=t.ubicacion,r.form.hectareas=t.hectareas,r.form.propietario=t.propietario,r.form.latitud=t.latitud,r.form.longitud=t.longitud}function V(){r.open=!1,r.id=null}async function A(){p.value=!0;try{const t={nombreFinca:r.form.nombre,ubicacion:r.form.ubicacion,hectareas:Number(r.form.hectareas||0),propietario:Number(r.form.propietario),latitud:r.form.latitud??null,longitud:r.form.longitud??null};await y.update(r.id,t,g.value),c("Finca actualizada","success"),V(),await k()}catch(t){c(t.message||"No se pudo actualizar","error")}finally{p.value=!1}}async function B(t){if(confirm(`Eliminar finca ${t.nombre}?`))try{await y.remove(t.id,g.value),c("Finca eliminada","success"),await k()}catch(e){c(e.message||"No se pudo eliminar","error")}}return H(()=>{k()}),(t,e)=>(s(),u(N,null,[o("section",G,[e[19]||(e[19]=o("header",null,[o("div",{class:"stat-chip"},"Registro activo"),o("h1",{class:"hero-title",style:{"font-size":"2.2rem"}},"Fincas conectadas"),o("p",{class:"hero-subtitle"},"Administra ubicaciones, geolocalizacion y propietarios con una interfaz lista para modo oscuro.")],-1)),o("form",{class:"form-grid two",onSubmit:L(P,["prevent"]),novalidate:""},[o("label",null,[e[12]||(e[12]=o("span",{class:"form-label"},"Nombre",-1)),d(o("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>n.nombre=l),class:"form-control",required:""},null,512),[[m,n.nombre,void 0,{trim:!0}]]),a.nombre?(s(),u("span",R,i(a.nombre),1)):b("",!0)]),o("label",null,[e[13]||(e[13]=o("span",{class:"form-label"},"Ubicacion",-1)),d(o("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>n.ubicacion=l),class:"form-control",required:""},null,512),[[m,n.ubicacion,void 0,{trim:!0}]]),a.ubicacion?(s(),u("span",J,i(a.ubicacion),1)):b("",!0)]),o("label",null,[e[14]||(e[14]=o("span",{class:"form-label"},"Hectareas",-1)),d(o("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>n.hectareas=l),type:"number",min:"0",step:"0.01",class:"form-control",required:""},null,512),[[m,n.hectareas,void 0,{number:!0}]]),a.hectareas?(s(),u("span",K,i(a.hectareas),1)):b("",!0)]),o("label",null,[e[16]||(e[16]=o("span",{class:"form-label"},"Propietario",-1)),d(o("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>n.propietario=l),class:"select-control",required:""},[e[15]||(e[15]=o("option",{value:""},"Selecciona",-1)),(s(!0),u(N,null,x(C.value,l=>(s(),u("option",{key:l.id,value:l.id},i(l.id)+" - "+i(l.nombre),9,O))),128))],512),[[q,n.propietario,void 0,{number:!0}]]),a.propietario?(s(),u("span",Q,i(a.propietario),1)):b("",!0)]),o("label",null,[e[17]||(e[17]=o("span",{class:"form-label"},"Latitud",-1)),d(o("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>n.latitud=l),type:"number",step:"0.000001",class:"form-control"},null,512),[[m,n.latitud,void 0,{number:!0}]])]),o("label",null,[e[18]||(e[18]=o("span",{class:"form-label"},"Longitud",-1)),d(o("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>n.longitud=l),type:"number",step:"0.000001",class:"form-control"},null,512),[[m,n.longitud,void 0,{number:!0}]])]),o("div",W,[o("button",{class:"btn btn-primary",type:"submit",disabled:p.value},i(p.value?"Guardando...":"Guardar finca"),9,X),o("button",{class:"btn btn-outline",type:"button",onClick:z,disabled:p.value},"Limpiar",8,Y)])],32)]),o("section",Z,[o("header",_,[e[20]||(e[20]=o("h2",{style:{"font-size":"1.2rem"}},"Fincas registradas",-1)),f.value.length?(s(),u("span",w,i(f.value.length)+" activas",1)):b("",!0)]),o("div",oo,[o("table",eo,[e[23]||(e[23]=o("thead",null,[o("tr",null,[o("th",null,"ID"),o("th",null,"Nombre"),o("th",null,"Ubicacion"),o("th",null,"Hectareas"),o("th",null,"Lat"),o("th",null,"Lng"),o("th",null,"Propietario"),o("th")])],-1)),o("tbody",null,[h.value?(s(),u("tr",to,[...e[21]||(e[21]=[o("td",{colspan:"8"},"Cargando datos...",-1)])])):b("",!0),(s(!0),u(N,null,x(f.value,l=>(s(),u("tr",{key:l.id},[o("td",null,i(l.id),1),o("td",null,i(l.nombre),1),o("td",null,i(l.ubicacion),1),o("td",null,i(l.hectareas),1),o("td",null,i(l.latitud??"-"),1),o("td",null,i(l.longitud??"-"),1),o("td",null,i(l.propietarioNombre??"-"),1),o("td",lo,[o("button",{class:"btn btn-outline",type:"button",onClick:v=>T(l)},"Editar",8,ro),o("button",{class:"btn btn-ghost",type:"button",style:{"margin-left":"0.5rem"},onClick:v=>B(l)},"Eliminar",8,no)])]))),128)),!h.value&&!f.value.length?(s(),u("tr",io,[...e[22]||(e[22]=[o("td",{colspan:"8"},"Sin registros por ahora.",-1)])])):b("",!0)])])])]),(s(),M($,{to:"body"},[r.open?(s(),u("div",ao,[o("div",so,[o("header",{class:"modal-header"},[e[24]||(e[24]=o("h2",null,"Editar finca",-1)),o("button",{class:"btn btn-ghost",type:"button",onClick:V},"Cerrar")]),o("form",{class:"form-grid two",onSubmit:L(A,["prevent"]),novalidate:""},[o("label",null,[e[25]||(e[25]=o("span",{class:"form-label"},"Nombre",-1)),d(o("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>r.form.nombre=l),class:"form-control",required:""},null,512),[[m,r.form.nombre,void 0,{trim:!0}]])]),o("label",null,[e[26]||(e[26]=o("span",{class:"form-label"},"Ubicacion",-1)),d(o("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>r.form.ubicacion=l),class:"form-control",required:""},null,512),[[m,r.form.ubicacion,void 0,{trim:!0}]])]),o("label",null,[e[27]||(e[27]=o("span",{class:"form-label"},"Hectareas",-1)),d(o("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>r.form.hectareas=l),type:"number",step:"0.01",min:"0",class:"form-control",required:""},null,512),[[m,r.form.hectareas,void 0,{number:!0}]])]),o("label",null,[e[29]||(e[29]=o("span",{class:"form-label"},"Propietario",-1)),d(o("select",{"onUpdate:modelValue":e[9]||(e[9]=l=>r.form.propietario=l),class:"select-control",required:""},[e[28]||(e[28]=o("option",{value:""},"Selecciona",-1)),(s(!0),u(N,null,x(C.value,l=>(s(),u("option",{key:l.id,value:l.id},i(l.id)+" - "+i(l.nombre),9,uo))),128))],512),[[q,r.form.propietario,void 0,{number:!0}]])]),o("label",null,[e[30]||(e[30]=o("span",{class:"form-label"},"Latitud",-1)),d(o("input",{"onUpdate:modelValue":e[10]||(e[10]=l=>r.form.latitud=l),type:"number",step:"0.000001",class:"form-control"},null,512),[[m,r.form.latitud,void 0,{number:!0}]])]),o("label",null,[e[31]||(e[31]=o("span",{class:"form-label"},"Longitud",-1)),d(o("input",{"onUpdate:modelValue":e[11]||(e[11]=l=>r.form.longitud=l),type:"number",step:"0.000001",class:"form-control"},null,512),[[m,r.form.longitud,void 0,{number:!0}]])]),o("div",mo,[o("button",{class:"btn btn-outline",type:"button",onClick:V},"Cancelar"),o("button",{class:"btn btn-primary",type:"submit",disabled:p.value},i(p.value?"Guardando...":"Actualizar"),9,po)])],32)])])):b("",!0)]))],64))}};export{fo as default};
