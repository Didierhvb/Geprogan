import{u as M,f as y,x,h,c as s,o as i,a as e,q as u,t as r,z as j,j as d,v as C,b as w,y as f,E as N,G as A,F as V,i as D,H as I,l as $}from"./index-Na7mEAWg.js";const z={class:"surface-panel",style:{display:"flex","flex-direction":"column",gap:"1.5rem"}},F={style:{display:"flex","justify-content":"space-between","flex-wrap":"wrap",gap:"1rem"}},B={key:0,class:"stat-chip"},L={key:0,class:"form-error"},P={key:0,class:"form-error"},R={key:0,class:"form-error"},G={key:0,class:"form-error"},O={key:0,class:"form-error"},_={key:0,class:"form-error"},H=["type"],J={key:0,class:"form-error"},K=["type"],Q={key:0,class:"form-error"},W={style:{display:"flex","align-items":"center",gap:"0.5rem"}},X={style:{display:"flex",gap:"1rem","align-items":"center"}},Y=["disabled"],Z=["disabled"],ee={class:"table-panel"},oe={style:{"overflow-x":"auto"}},le={class:"table"},te={key:0},ne={style:{"text-align":"right"}},ae=["onClick"],re={key:1},de={__name:"UsuariosView",setup(se){const{token:U}=M(),{pushToast:m}=$(),p=y([]),b=y(!0),c=y(!1),v=y(!1),l=x({tipoIdentificacion:"",idUsuario:null,rol:"",nombre:"",apellido:"",email:"",telefono:"",contrasena:"",confirmar:""}),a=x({tipoIdentificacion:"",rol:"",nombre:"",apellido:"",email:"",telefono:"",contrasena:"",confirmar:""});function T(n){const o=n.idusuario??n.id??null,t=`${n.nombreUr??n.nombre??""} ${n.apellidoUr??n.apellido??""}`.trim();return{id:o,nombre:t,email:n.emailUr??n.email??"",telefono:n.telefonoUr??n.telefono??"",rolNombre:n.rolNombre??n.rol??n.nombreRol??""}}async function g(){b.value=!0;try{const n=await I.list(U.value);p.value=(n||[]).map(T).filter(o=>o.id)}catch(n){m(n.message||"No se pudo cargar usuarios","error")}finally{b.value=!1}}function q(){return a.tipoIdentificacion=l.tipoIdentificacion?"":"Selecciona un tipo",a.rol=l.rol?"":"Selecciona rol",a.nombre=l.nombre?"":"Ingresa nombre",a.apellido=l.apellido?"":"Ingresa apellido",a.email=/.+@.+/.test(l.email)?"":"Correo invalido",a.telefono=/^\d{10}$/.test(l.telefono)?"":"Telefono 10 digitos",a.contrasena=l.contrasena&&l.contrasena.length>=8?"":"Minimo 8 caracteres",a.confirmar=l.contrasena===l.confirmar?"":"Las contrasenas no coinciden",Object.values(a).every(n=>!n)}async function S(){if(q()){c.value=!0;try{const n={IdrolUr:Number(l.rol),TipoIdentificacion:l.tipoIdentificacion,NombreUr:l.nombre,ApellidoUr:l.apellido,EmailUr:l.email,TelefonoUr:l.telefono,Contrasena:l.contrasena,UrlImageUr:""};l.idUsuario&&(n.Idusuario=Number(l.idUsuario)),await I.create(n,U.value),m("Usuario creado","success"),k(),await g()}catch(n){m(n.message||"No se pudo crear usuario","error")}finally{c.value=!1}}}function k(){l.tipoIdentificacion="",l.idUsuario=null,l.rol="",l.nombre="",l.apellido="",l.email="",l.telefono="",l.contrasena="",l.confirmar=""}async function E(n){if(confirm(`Eliminar usuario ${n.nombre}?`))try{await I.remove(n.id,U.value),m("Usuario eliminado","success"),await g()}catch(o){m(o.message||"No se pudo eliminar","error")}}return h(()=>{g()}),(n,o)=>(i(),s(V,null,[e("section",z,[e("header",F,[o[10]||(o[10]=e("div",null,[e("div",{class:"stat-chip"},"Equipo"),e("h1",{class:"hero-title",style:{"font-size":"2.1rem"}},"Usuarios del sistema"),e("p",{class:"hero-subtitle"},"Controla acceso por roles y comunica estados con feedback inmediato.")],-1)),p.value.length?(i(),s("span",B,r(p.value.length)+" activos",1)):u("",!0)]),e("form",{class:"form-grid two",onSubmit:j(S,["prevent"]),novalidate:""},[e("label",null,[o[12]||(o[12]=e("span",{class:"form-label"},"Tipo identificacion",-1)),d(e("select",{"onUpdate:modelValue":o[0]||(o[0]=t=>l.tipoIdentificacion=t),class:"select-control",required:""},[...o[11]||(o[11]=[w('<option value="">Selecciona</option><option value="CC">Cedula de ciudadania</option><option value="TI">Tarjeta de identidad</option><option value="CE">Cedula de extranjeria</option><option value="NIT">NIT</option><option value="PAS">Pasaporte</option>',6)])],512),[[C,l.tipoIdentificacion]]),a.tipoIdentificacion?(i(),s("span",L,r(a.tipoIdentificacion),1)):u("",!0)]),e("label",null,[o[13]||(o[13]=e("span",{class:"form-label"},"ID usuario (opcional)",-1)),d(e("input",{"onUpdate:modelValue":o[1]||(o[1]=t=>l.idUsuario=t),type:"number",min:"1",class:"form-control"},null,512),[[f,l.idUsuario,void 0,{number:!0}]])]),e("label",null,[o[15]||(o[15]=e("span",{class:"form-label"},"Rol",-1)),d(e("select",{"onUpdate:modelValue":o[2]||(o[2]=t=>l.rol=t),class:"select-control",required:""},[...o[14]||(o[14]=[e("option",{value:""},"Selecciona",-1),e("option",{value:"1"},"Administrador",-1),e("option",{value:"2"},"Operador",-1),e("option",{value:"3"},"Invitado",-1)])],512),[[C,l.rol,void 0,{number:!0}]]),a.rol?(i(),s("span",P,r(a.rol),1)):u("",!0)]),e("label",null,[o[16]||(o[16]=e("span",{class:"form-label"},"Nombre",-1)),d(e("input",{"onUpdate:modelValue":o[3]||(o[3]=t=>l.nombre=t),class:"form-control",required:""},null,512),[[f,l.nombre,void 0,{trim:!0}]]),a.nombre?(i(),s("span",R,r(a.nombre),1)):u("",!0)]),e("label",null,[o[17]||(o[17]=e("span",{class:"form-label"},"Apellido",-1)),d(e("input",{"onUpdate:modelValue":o[4]||(o[4]=t=>l.apellido=t),class:"form-control",required:""},null,512),[[f,l.apellido,void 0,{trim:!0}]]),a.apellido?(i(),s("span",G,r(a.apellido),1)):u("",!0)]),e("label",null,[o[18]||(o[18]=e("span",{class:"form-label"},"Correo",-1)),d(e("input",{"onUpdate:modelValue":o[5]||(o[5]=t=>l.email=t),type:"email",class:"form-control",required:""},null,512),[[f,l.email,void 0,{trim:!0}]]),a.email?(i(),s("span",O,r(a.email),1)):u("",!0)]),e("label",null,[o[19]||(o[19]=e("span",{class:"form-label"},"Telefono",-1)),d(e("input",{"onUpdate:modelValue":o[6]||(o[6]=t=>l.telefono=t),maxlength:"10",class:"form-control",inputmode:"numeric",required:""},null,512),[[f,l.telefono,void 0,{trim:!0}]]),a.telefono?(i(),s("span",_,r(a.telefono),1)):u("",!0)]),e("label",null,[o[20]||(o[20]=e("span",{class:"form-label"},"Contrasena",-1)),d(e("input",{type:v.value?"text":"password","onUpdate:modelValue":o[7]||(o[7]=t=>l.contrasena=t),class:"form-control",required:"",minlength:"8"},null,8,H),[[N,l.contrasena]]),a.contrasena?(i(),s("span",J,r(a.contrasena),1)):u("",!0)]),e("label",null,[o[21]||(o[21]=e("span",{class:"form-label"},"Confirmar",-1)),d(e("input",{type:v.value?"text":"password","onUpdate:modelValue":o[8]||(o[8]=t=>l.confirmar=t),class:"form-control",required:"",minlength:"8"},null,8,K),[[N,l.confirmar]]),a.confirmar?(i(),s("span",Q,r(a.confirmar),1)):u("",!0)]),e("label",W,[d(e("input",{type:"checkbox","onUpdate:modelValue":o[9]||(o[9]=t=>v.value=t)},null,512),[[A,v.value]]),o[22]||(o[22]=e("span",null,"Mostrar contrasena",-1))]),e("div",X,[e("button",{class:"btn btn-primary",type:"submit",disabled:c.value},r(c.value?"Guardando...":"Crear usuario"),9,Y),e("button",{class:"btn btn-outline",type:"button",onClick:k,disabled:c.value},"Limpiar",8,Z)])],32)]),e("section",ee,[o[26]||(o[26]=e("header",{style:{display:"flex","justify-content":"space-between","align-items":"center",padding:"1.5rem 1.5rem 0"}},[e("h2",{style:{"font-size":"1.2rem"}},"Usuarios")],-1)),e("div",oe,[e("table",le,[o[25]||(o[25]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"Nombre"),e("th",null,"Email"),e("th",null,"Telefono"),e("th",null,"Rol"),e("th")])],-1)),e("tbody",null,[b.value?(i(),s("tr",te,[...o[23]||(o[23]=[e("td",{colspan:"6"},"Cargando usuarios...",-1)])])):u("",!0),(i(!0),s(V,null,D(p.value,t=>(i(),s("tr",{key:t.id},[e("td",null,r(t.id),1),e("td",null,r(t.nombre),1),e("td",null,r(t.email),1),e("td",null,r(t.telefono),1),e("td",null,r(t.rolNombre),1),e("td",ne,[e("button",{class:"btn btn-ghost",type:"button",onClick:ie=>E(t)},"Eliminar",8,ae)])]))),128)),!b.value&&!p.value.length?(i(),s("tr",re,[...o[24]||(o[24]=[e("td",{colspan:"6"},"Sin usuarios registrados.",-1)])])):u("",!0)])])])])],64))}};export{de as default};
